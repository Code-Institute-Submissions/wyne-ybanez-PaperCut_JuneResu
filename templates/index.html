{% extends "base.html" %}

{% block header %}

  {% if header_img %}
    <!-- Header Image -->
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="site-heading">
                    <h1 class="text-shadow site-logo">Papercuts</h1>
                    <span class="subheading text-shadow white-text site-logo">
                      Critical Book Reviews and Rants
                    </span>
                </div>
            </div>
        </div>
    </div>
  {% endif %}
{% endblock %}

{% block content %}
  {% if posts|length > 0 %}

<div class="row">

  <div class="col l3 s12">
    <div class="genre-search">
      <h2>Search Genres:</h2>
        <ul>
            {% for genre in genres %}
              <li class="genre-list">
                  <p>{{ genre.genre_name }}</p>
              </li>
            {% endfor %}
        </ul>
    </div>
  </div>

  <div id="post-card" class="col s12 l9">
    {% for post in posts %}
      <div href="{{ url_for('show_post', post_id=post._id, header=header) }}" class="card hoverable grey lighten-4">

      <!-- Genre Image based on genre_id-->
      <div class="card-image">
        {% if post.genre_id == '60801478c4a5cd24e572d02e' %}
          <img src="{{ url_for('static', filename='images/nature.jpg') }}" alt="Nature genre image">
        {% elif post.genre_id == '60800dded88bad5caa6671f2' %}
          <img src="{{ url_for('static', filename='images/thriller.jpeg') }}" alt="Thriller genre image">
        {% elif post.genre_id =='6073348f0c164046e72ced61' %}
          <img src="{{ url_for('static', filename='images/comedy.jpeg') }}" alt="Comedy genre image">
        {% elif post.genre_id == '607334580c164046e72ced5e' %}
          <img src="{{ url_for('static', filename='images/adventure.jpeg') }}" alt="Adventure genre image">
        {% elif post.genre_id == '6073344c0c164046e72ced5d' %}
          <img src="{{ url_for('static', filename='images/fantasy.jpeg') }}" alt="Fantasy genre image">
        {% elif post.genre_id == '607334630c164046e72ced5f' %}
          <img src="{{ url_for('static', filename='images/romance.jpeg') }}" alt="Romance genre image">
        {% elif post.genre_id == '608023ded9f71798665a5741' %}
          <img src="{{ url_for('static', filename='images/none.jpeg') }}" alt="No Genre image">
        {% endif %}       

        <!-- Display genre name based on genre_id -->
            <span class="card-title white-text text-shadow">{{ post.genre_name }}</span>
 
        <!-- Card Buttons  -->
        <!-- Add Post -->
          <!-- Must be registered User -->
        {% if session.user|lower %}
          <a href="{{ url_for('add_post') }}" class="btn-floating plus halfway-fab waves-effect waves-light main-color">
            <i class="fas fa-plus"></i>
          </a>
        {% else %}
          <a href="{{ url_for('login') }}" class="btn-floating plus halfway-fab waves-effect waves-light main-color">
            <i class="fas fa-plus"></i>
          </a>
        {% endif %}
        <!-- Read Post -->
        <a href="{{ url_for('show_post', post_id=post._id) }}"
          class="btn-floating halfway-fab waves-effect waves-light">
          <i class="fas fa-search"></i>
        </a>
        <!-- Edit Post -->
        {% if session.user|lower == post.created_by|lower %}
          <a href="{{ url_for('edit_post', post_id=post._id) }}"
            class="btn-floating pen halfway-fab waves-effect waves-light">
            <i class="fas fa-pen"></i>
          </a>
        {% endif %}
      </div>

      <!-- Card Description -->
      <div class="card-content">
        <a href="{{ url_for('show_post', post_id=post._id) }}" class="post-title black-text">
          <strong>{{ post.post_title }}</strong>
        </a>
        <p><em>Book:</em> 
          {{ post.book }}
        </p>
        <br>
        <p><em>Review:</em></p>
        <p class="card-review">{{ post.review }}</p>
          <a href="{{ url_for('show_post', post_id=post._id) }}" class="center-align deep-orange-text link">
            Read more
          </a>
        <br>
        <br>
        <p><em>Author:</em>
          {{ post.created_by }}
        </p>
        <!-- Display dates and edit dates -->
        {% if post.date %}
          <p><em>Date:</em>
            {{ post.date }}
          </p>
        {% elif post.edit_date %}
          <p><em>Latest Edit:</em>
            {{ post.edit_date }}
          </p>
        {% endif %}
      </div>
      <!-- Read Review -->
      <div class="card-action">
        <a href="{{ url_for('show_post', post_id=post._id) }}" class="center-align deep-orange-text link">Read</a>
        <!-- Edit and Delete -->
        {% if session.user|lower == post.created_by|lower %}
          <a href="{{ url_for('edit_post', post_id=post._id) }}" class="center-align deep-orange-text link">Edit</a>
        {% endif%}
        {% if session.user|lower == post.created_by|lower or session.user|lower == 'admin'%}
          <a href="{{ url_for('delete_post', post_id=post._id) }}" class="center-align deep-orange-text link">Delete</a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- No Results from search -->
  {% else %}
      <h3 class="center-align red-text">No Results Found</h3>
  {% endif %}

{% endblock %}